# ARP

Address Resolution Protocol

地址解析协议

用于将IP地址映射为MAC地址，在主机ARP高速缓存中存放本局域网内各主机和路由器从IP地址到硬件地址的映射表。

## 工作流程

当主机A向本局域网内的主机B发送IP数据报时，首先在本机ARP高速缓存中查找主机B的IP地址，取相应MAC地址写入MAC帧。

若未找到主机B的条目，则在本局域网广播ARP请求报文。主机B收到ARP请求报文后，在ARP高速缓存中添加A的条目，然后向主机A发送ARP响应报文。

其余收到ARP请求报文的主机都不响应，但要更新ARP高速缓存中A的条目。主机A收到主机B的ARP响应报文后，在ARP高速缓存中添加主机B的条目。

高速缓存中的每一个条目都有生存时间，超过生存时间的条目会被删除。

若目的IP地址不在本局域网内，则MAC地址被映射为相应网关的MAC地址。

## 报文格式

<table>
	<tr>
		<th>字节</th>
		<th>2</th>
		<th>2</th>
		<th>1</th>
		<th>1</th>
		<th>2</th>
		<th>6</th>
		<th>4</th>
		<th>6</th>
		<th>4</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>硬件类型</td>
		<td>协议类型</td>
		<td>硬件地址长度</td>
		<td>协议地址长度</td>
		<td>操作</td>
		<td>源MAC地址</td>
		<td>源IP地址</td>
		<td>目的MAC地址</td>
		<td>目的IP地址</td>
	</tr>
</table>

##### 硬件类型

- 0x0001 以太网地址

##### 协议类型

- 0x0800 IP协议

##### 操作

- 0x0001 ARP请求
- 0x0002 ARP应答
- 0x0003 RARP请求
- 0x0004 RARP应答