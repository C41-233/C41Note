# MD5

MD5信息摘要算法，一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。

## 原理

MD5的计算过程中的数值，都以小端序表示。即低位数据在前，高位数据在后。所有运算都是无符号计算。

```
内容为hello的ASCII文本文件，有40位（5字节）长。

01101000 01100101 01101100 01101100 01101111
```

#### 1. 数据填充
对源数据填充，使其成为一个(N*512-64)位大小的数据。第一位填充1，后面都补0。

```
填充1个1和407个0，填充后为448位（57字节）。

01101000 01100101 01101100 01101100 01101111 10000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
```

#### 2. 填充长度

继续在后面填充64位（8字节）的源数据位长度，超过64位的部分取低64位（即n mod 2<sup>64</sup>）。

```
填充长度40。
01101000 01100101 01101100 01101100 01101111 10000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00101000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
```

#### 3. 数据分组

将数据按照每512位（64字节）为一组，每组分为16个32位int。

```
只有一段
[00] 01101000 01100101 01101100 01101100 
[01] 01101111 10000000 00000000 00000000
[02] 00000000 00000000 00000000 00000000 
[03] 00000000 00000000 00000000 00000000
[04] 00000000 00000000 00000000 00000000 
[05] 00000000 00000000 00000000 00000000
[06] 00000000 00000000 00000000 00000000 
[07] 00000000 00000000 00000000 00000000
[08] 00000000 00000000 00000000 00000000 
[09] 00000000 00000000 00000000 00000000
[10] 00000000 00000000 00000000 00000000 
[11] 00000000 00000000 00000000 00000000
[12] 00000000 00000000 00000000 00000000 
[13] 00000000 00000000 00000000 00000000
[14] 00101000 00000000 00000000 00000000 
[15] 00000000 00000000 00000000 00000000
```

#### 4. 常量与函数定义

四个常量初始值：
- A = 0x01234567
- B = 0x89ABCDEF
- C = 0xFEDCBA98
- D = 0x76543210

四个基础线性函数：
- F(x, y, z) = (x & y) | ((~x) & z)
- G(x, y, z) = (x & z) | (y & (~z))
- H(x, y, z) = x ^ y ^ z
- I(x, y, z) = y ^ (x | (~z))

四个数据处理函数
- FF(a, b, c, d, M, s, t) => a = b + ((a + F(b,c,d) + M + t)<<<s)
- GG(a, b, c, d, M, s, t) => a = b + ((a + G(b,c,d) + M + t)<<<s)
- HH(a, b, c, d, M, s, t) => a = b + ((a + H(b,c,d) + M + t)<<<s)
- II(a, b, c, d, M, s, t) => a = b + ((a + I(b,c,d) + M + t)<<<s)

#### 5. 计算

对每一组分别进行以下四轮计算，Mi表示每组第i个32位int：
``` C
a = A
b = B
c = C
d = D

FF(a, b, c, d, M0, 7, 0xd76aa478)
FF(d, a, b, c, M1, 12, 0xe8c7b756)
FF(c, d, a, b, M2, 17, 0x242070db)
FF(b, c, d, a, M3, 22, 0xc1bdceee)
FF(a, b, c, d, M4, 7, 0xf57c0faf)
FF(d, a, b, c, M5, 12, 0x4787c62a)
FF(c, d, a, b, M6, 17, 0xa8304613)
FF(b, c, d, a, M7, 22, 0xfd469501)
FF(a, b, c, d, M8, 7, 0x698098d8)
FF(d, a, b, c, M9, 12, 0x8b44f7af)
FF(c, d, a, b, M10, 17, 0xffff5bb1)
FF(b, c, d, a, M11, 22, 0x895cd7be)
FF(a, b, c, d, M12, 7, 0x6b901122)
FF(d, a, b, c, M13, 12, 0xfd987193)
FF(c, d, a, b, M14, 17, 0xa679438e)
FF(b, c, d, a, M15, 22, 0x49b40821)

GG(a, b, c, d, M1, 5, 0xf61e2562)
GG(d, a, b, c, M6, 9, 0xc040b340)
GG(c, d, a, b, M11, 14, 0x265e5a51)
GG(b, c, d, a, M0, 20, 0xe9b6c7aa)
GG(a, b, c, d, M5, 5, 0xd62f105d)
GG(d, a, b, c, M10, 9, 0x02441453)
GG(c, d, a, b, M15, 14, 0xd8a1e681)
GG(b, c, d, a, M4, 20, 0xe7d3fbc8)
GG(a, b, c, d, M9, 5, 0x21e1cde6)
GG(d, a, b, c, M14, 9, 0xc33707d6)
GG(c, d, a, b, M3, 14, 0xf4d50d87)
GG(b, c, d, a, M8, 20, 0x455a14ed)
GG(a, b, c, d, M13, 5, 0xa9e3e905)
GG(d, a, b, c, M2, 9, 0xfcefa3f8)
GG(c, d, a, b, M7, 14, 0x676f02d9)
GG(b, c, d, a, M12, 20, 0x8d2a4c8a)

HH(a, b, c, d, M5, 4, 0xfffa3942)
HH(d, a, b, c, M8, 11, 0x8771f681)
HH(c, d, a, b, M11, 16, 0x6d9d6122)
HH(b, c, d, a, M14, 23, 0xfde5380c)
HH(a, b, c, d, M1, 4, 0xa4beea44)
HH(d, a, b, c, M4, 11, 0x4bdecfa9)
HH(c, d, a, b, M7, 16, 0xf6bb4b60)
HH(b, c, d, a, M10, 23, 0xbebfbc70)
HH(a, b, c, d, M13, 4, 0x289b7ec6)
HH(d, a, b, c, M0, 11, 0xeaa127fa)
HH(c, d, a, b, M3, 16, 0xd4ef3085)
HH(b, c, d, a, M6, 23, 0x04881d05)
HH(a, b, c, d, M9, 4, 0xd9d4d039)
HH(d, a, b, c, M12, 11, 0xe6db99e5)
HH(c, d, a, b, M15, 16, 0x1fa27cf8)
HH(b, c, d, a, M2, 23, 0xc4ac5665)

II(a, b, c, d, M0, 6, 0xf4292244)
II(d, a, b, c, M7, 10, 0x432aff97)
II(c, d, a, b, M14, 15, 0xab9423a7)
II(b, c, d, a, M5, 21, 0xfc93a039)
II(a, b, c, d, M12, 6, 0x655b59c3)
II(d, a, b, c, M3, 10, 0x8f0ccc92)
II(c, d, a, b, M10, 15, 0xffeff47d)
II(b, c, d, a, M1, 21, 0x85845dd1)
II(a, b, c, d, M8, 6, 0x6fa87e4f)
II(d, a, b, c, M15, 10, 0xfe2ce6e0)
II(c, d, a, b, M6, 15, 0xa3014314)
II(b, c, d, a, M13, 21, 0x4e0811a1)
II(a, b, c, d, M4, 6, 0xf7537e82)
II(d, a, b, c, M11, 10, 0xbd3af235)
II(c, d, a, b, M2, 15, 0x2ad7d2bb)
II(b, c, d, a, M9, 21, 0xeb86d391)

A += a
B += b
C += c
D += d
```

对每一组都计算完毕后，所得ABCD组合即为最终128位MD5值。

## 字符串表示

将一个已经经过MD5编码后的字节数组，转换为字符串表示。

### 实现
##### C#
``` C#
public static string Convert(byte[] md5Data)
{
    var str = new StringBuilder()
    foreach (var b in md5Data)
    {
        str.Append(b.ToString("x").PadLeft(2, '0'))
    }
    return str.ToString()
}
```