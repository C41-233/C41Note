# 红黑树

红黑树是一棵二叉搜索树，树中的每一个结点都被标记上黑色或者红色，并满足：
1. 根结点和所有叶结点是黑色。
2. 从根结点到叶结点的路径上没有连续两个红色结点，但可以有连续的黑色结点。
3. 所有从根结点到叶结点的路径都有相同数目的黑色结点。

父结点到黑色子结点的指针称为黑色指针，父结点到红色子结点的指针称为红色指针，则上述条件等价于：
1. 指向叶结点的指针是黑色。
2. 根结点到叶结点的路径上没有连续两个红色指针，但可以有连续的黑色指针。
3. 所有根结点到叶结点的路径上都有相同数目的黑色指针。

红黑树的数据都存储在非叶结点上，叶结点不存储数据。因此将叶结点称为外部结点，非叶结点称为内部结点。红黑树的叶结点是虚拟出的结点，方便旋转。

![](1.png)

##### 黑高度

红黑树的结点x到叶结点的路径上黑色结点的个数（不包括结点x本身），称为结点x的黑高度（阶），记作bh(x)。

注意结点x到任一根结点的路径上黑色结点的个数是相等的。

##### 路径长度

红黑树的路径长度是路径上的指针个数，记作PL。

## 推论

1、若P与Q是红黑树中两条从根结点到叶结点的路径，则有PL(P)≤2PL(Q)。

2、一棵有n个非叶结点的红黑树高度至多为2log(n+1)。

3、红黑树的高度至多为根结点的黑高度的2倍。

4、设r为红黑树根结点的黑高度，则红黑树的结点个数至少为2<sup>r</sup>-1。

## 插入

将关键字k插入红黑树，首先通过二叉搜索树搜索，将新结点插入到最外层的内部结点。随后对结点染色并调整。

1 如果插入前是空树，则新插入的结点成为根结点，并染上黑色，为其引入两个外部结点。插入完成。

2 否则，将新结点染上红色。设新结点为X，其父结点为P，父结点的兄弟结点为PP，祖父结点为G。

2.1 若P是黑色结点，则插入完成。

2.2 若P是红色结点，则G是黑色结点。分为两种情况。

2.2.1 若PP是红色结点，则将G染上红色，P和PP染上黑色。此时，若G是根结点，则染上黑色；否则，将G递归向上调整。

![](2.png)

2.2.2 若PP是黑色结点，则再分为四种情况。

2.2.2.1 若X是P是左子结点，P是G的左子结点，则将X向右单旋转。P染上黑色，G染上红色。

![](3.png)

2.2.2.2 若X是P的右子结点，P是G的左子结点，则将X执行左-右双旋转。X染上黑色，G染上红色。

![](4.png)

2.2.2.3 若X是P的右子结点，P是G的右子结点，则将X向左单旋转。P染上黑色，G染上红色。

2.2.2.4 若X是P的左子结点，P是G的右子结点，则将X执行右-左双旋转。X染上黑色，G染上红色。