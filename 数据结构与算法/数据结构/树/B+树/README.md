# B+树

B+树是B树的变种，一棵m阶B+树具有满足：
1. 每个结点至多有m棵子树。
2. 根结点至少有一棵子树，其他非叶结点至少有⌈m/2⌉棵子树。
3. 有n棵子树的非叶结点有n个关键字，关键字在结点内按照从小到大的顺序排列，每个关键字是其对应子树的最大关键字，表示一个索引。
4. 所有叶结点都在同一层，按从小到大的顺序链接，并存放全部关键字，它是数据记录的索引。

在B+树中，所有叶结点以链表的形式链接。只有叶结点中的关键字包含卫星数据，其他结点都不包含卫星数据。因此同样大小的磁盘也可以容纳更多的结点元素。

非叶结点中的关键字是其对应子结点中关键字的最大值，因此非叶结点的关键字必然出现在其子结点中。根结点的最大关键字必然也是B+树的最大关键字。

一棵B树包含2个指针，一个指向根结点，一个指向最左叶结点。

![](1.jpg)

## 查找

从根结点开始，自顶向下搜索，直到叶结点，数据总是存在叶结点中。

## 插入

插入总是在叶结点上进行，首先搜索出要插入的关键字所在的叶结点，在该叶结点上插入关键字。如果插入后关键字个数为m+1，则该结点分裂。分裂后的两个结点关键字个数分别为⌈(m+1)/2⌉和⌊(m+1)/2⌋。此时，视为递归在父结点中插入分裂后左结点的最大关键字。

如果根结点发生分裂，则生成新的根结点，此时树的深度增加。

## 删除

删除总是在叶结点上进行，首先搜索出要删除的关键字所在的叶结点，在该叶结点上删除关键字。如果删除后关键字个数少于⌈m/2⌉，则：
- 若紧邻右兄弟结点关键字个数大于⌈m/2⌉，则取紧邻右兄弟结点的最小关键字移动到该结点中作为最大关键字，并调整父结点对应关键字为该被移动的关键字。
- 若紧邻右兄弟结点关键字个数等于⌈m/2⌉，则该结点与紧邻右兄弟结点合并，并视为递归在父结点中删除该结点对应的关键字。

如果根结点的最后两棵子树合并，则根结点被合并后的结点取代，此时树的深度减少。