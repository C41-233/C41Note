# 语法

## 变量

##### var

函数作用域。

对var声明的变量存在变量提升，视为在函数顶部声明。仅声明被提升，赋值未被提升，初始值为undefined。

```
console.log(a); // undefined
var a = 5;
```

重复定义的变量是同一个变量。

```
var a = 5;
{
    var a = 6;
}
console.log(a); // 6
```

在顶层作用域中用var声明的变量，成为顶层对象的属性。

##### let

块级作用域。

```
{
    let a = 10;
}
console.log(a); // ReferenceError: a is not defined.
```

必须首先执行过let语句，才能使用声明的变量，否则抛出ReferenceError。

```
console.log(a); // ReferenceError: a is not defined.
let a = 5;
```

不允许在同一个作用域内重复声明变量，否则抛出SyntaxError。

```
let a = 10;
let a = 20; // SyntaxError: Identifier 'a' has already been declared
```

##### const

块级作用域，与let类似。

声明只读常量，且必须立即初始化，否则抛出SyntaxError。常量不可修改，否则抛出TypeError。

##### 全局变量

给未定义的变量赋值，属于创造了一个全局变量，并成为顶层对象的属性。

```
function f(){
    a = 5;    
}
f();
console.log(a); // 5
```

## 函数

### function

本质是声明了一个函数变量。

在顶层作用域中声明的函数，成为顶层对象的属性。

### 声明作用域

##### ES5

ES5规定，函数只能在顶层作用域和函数作用域中声明，并会提升到对应作用域的顶部。

非严格模式下，块级作用域声明的函数会提升到函数作用域。严格模式下产生编译错误。

##### ES6

ES6规定，函数可以在顶层作用域、函数作用域和块级作用域中声明，并会提升到对应作用域的顶部。其中块级作用域必须使用大括号。

但是，浏览器下可以不遵守此项规定，而按照：
- 允许在块级作用域内声明函数
- 提升到函数作用域或全局作用域顶部

## 对象

### 顶层对象

ES环境中总是存在一个顶层对象，但不同的执行环境实现不统一。

| 环境 | 顶层对象 |
|---|---|
| 浏览器 | window、self |
| Web Worker | self |
| Node | global |

### this

##### 顶层作用域 

全局环境下，返回顶层对象。但是在Node模块和ES6模块中，返回当前模块。

##### 函数

this取决于函数的调用方式，而非函数的定义方式。

以普通方法调用，非严格模式下返回顶层对象，严格模式下返回undefined。

以对象方法或构造方法调用，返回调用绑定的对象。

##### new Function

`new Function("return this;")`，返回全局对象。