# UDP

User Datagram Protocol

用户数据报协议

UDP是一个简单的面向报文的通信协议，位于OSI模型的传输层。网络层基于IP协议，协议号为17。

UDP具有以下特点：

- 发送数据前不需要建立连接。
- 不可靠传输。
- 面向报文，对上层交付的报文添加UDP首部后就交付给下层，既不拆分，也不合并，应用程序需要选择合适的报文大小。
- 不进行拥塞控制。

UDP适用于不需要可靠传输，允许丢包，但对时间有较高要求的应用程序。例如，视频、语音等，DNS、DHCP、SNMP、RIP、NTP等是基于UDP的协议。

## UDP数据报格式

UDP数据报封装在IP数据报的数据部分。

<table>
	<thead><tr>
		<th>字节</th>
		<th>2</th>
		<th>2</th>
		<th>2</th>
		<th>2</th>
		<th>可变</th>
	</tr></thead>
	<tr>
		<th>字段</th>
		<td>源端口</td>
		<td>目的端口</td>
		<td>长度</td>
		<td>检验和</td>
		<td>数据部分</td>
	</tr>
</table>
	
##### 源端口和目的端口	

发送的源端口号和目的端口号。源端口可以省略为0。

接收方收到目的端口号不正确的UDP报文，就丢弃该报文，并发送ICMP端口不可达报文给发送方。

##### 长度	

UDP数据报长度（包括UDP首部和数据），单位为字节。

最小值为8，即仅包括首部。最大值为65535，数据部分最多65527字节。实际上通过IPv4协议传输时，IPv4头部占用20字节，因此UDP数据部分实际不能超过65507字节。

##### 检验和	

在数据报之前添加伪首部再计算校验和。

在IPv4中，校验和可以省略为0；但是在IPv6中，必须计算校验和。如果校验和计算结果为0，则校验和的位设置为全1。

## UDP伪首部

计算UDP报文中的校验和时，需要加上伪的IP数据报首部。伪首部中的报文长度包括了伪首部长度和

##### IPv4伪首部

<table>
	<tr>
		<th>字节</th>
		<th>4</th>
		<th>4</th>
		<th>1</th>
		<th>1</th>
		<th>2</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>源IP地址</td>
		<td>目的IP地址</td>
		<td>0</td>
		<td>协议（17）</td>
		<td>UDP报文长度</td>
	</tr>
</table>

##### IPv6伪首部

<table>
	<tr>
		<th>字节</th>
		<th>16</th>
		<th>16</th>
		<th>4</th>
		<th>3</th>
		<th>1</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>源IP地址</td>
		<td>目的IP地址</td>
		<td>UDP报文长度</td>
		<td>0</td>
		<td>下一个指针位置</td>
	</tr>
</table>
