# RIP

Routing Information Protocol

路由选择信息协议

RIP是一种使用最广泛的内部网关协议，它可以通过不断的交换信息让路由器动态的适应网络连接的变化，这些信息包括每个路由器可以到达哪些网络，这些网络有多远等。

目前RIP共有三个版本，RIPv1，RIPv2，RIPng。RIP基于UDP协议，但为网络层提供服务。

RIP要求网络中的每一个路由器都维护它自己到其他每一个目的网络的距离记录。RIP允许一条路径最多只能包含15个路由器，距离16表示不可达。RIP会选择一条经过最少路由器的路径路由。

路由器只和相邻的其他路由器交换信息，不相邻的路由器不交换信息。交换的信息是自己的路由表，按固定的时间间隔交换路由信息。

## RIP距离向量算法

路由表中的每一项包括目的网络、距离、下一跳路由器地址。

对从相邻路由器X收到的RIP报文，修改此报文中的下一跳地址为X，距离字段加1。

若路由表中不存在目的网络N，则把该项加入路由表。否则，若与路由表中的项目下一跳地址一致，则把收到的项目替换原来的项目。否则，若收到的项目距离小于路由表中距离，则把收到的项目替换原来的项目。

若经过180秒还没有收到相邻路由器的RIP报文，则将此路由器距离设为16（不可达）。

## RIP报文

RIP报文封装在UDP报文的数据部分，使用端口号520。

---

### RIPv1

<table>
	<thead><tr>
		<th></th>
		<th colspan="3">首部</th>
		<th colspan="6">路由部分，至多25项</th>
	</tr></thead>
	<tr>
		<th>字节</th>
		<th>1</th>
		<th>1</th>
		<th>2</th>
		<th>2</th>
		<th>2</th>
		<th>4</th>
		<th>4</th>
		<th>4</th>
		<th>4</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>命令</td>
		<td>版本（1）</td>
		<td>0</td>
		<td>地址族</td>
		<td>0</td>
		<td>IP地址</td>
		<td>0</td>
		<td>0</td>
		<td>度量</td>
	</tr>
</table>

---

### RIPv2

<table>
	<thead><tr>
		<th></th>
		<th colspan="3">首部</th>
		<th colspan="6">路由部分，至多25项</th>
	</tr></thead>
	<tr>
		<th>字节</th>
		<th>1</th>
		<th>1</th>
		<th>2</th>
		<th>2</th>
		<th>2</th>
		<th>4</th>
		<th>4</th>
		<th>4</th>
		<th>4</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>命令</td>
		<td>版本（2）</td>
		<td>0</td>
		<td>地址族</td>
		<td>路由标记</td>
		<td>IP地址</td>
		<td>子网掩码</td>
		<td>下一跳路由地址</td>
		<td>度量</td>
	</tr>
</table>

##### 命令	

- 1 请求
- 2 应答
- 5 轮询
- 6 轮询表项

##### 地址族	

- 2 IP地址


##### 路由标记	

自制系统号。

##### 下一跳路由地址	

目的IP地址的下一条路由IP地址。0表示发送RIP报文的系统。

##### 度量	

跳数，范围为1-15，16表示不可达。