# IGMP

Internet Group Management Protocol

网际组管理协议

IGMP是用于管理因特网多播组成员的通信协议。IP主机和相邻的路由器利用IGMP来创建多播组的组成员。

当某个主机加入新的多播组时，该主机应向多播组的多播地址发送一个IGMP报告报文，声明自己要成为该组的成员。主机的多个进程加入同一组时，只发送一个IGMP报告报文。主机发送的IGMP报告报文不一定被可靠交付，因此间隔一段时间内（0-10秒内随机选择）再次发送。

当主机离开一个多播组时（所有组内进程都离开多播组），主机不发送IGMP报告，而是在随后的IGMP查询中不报告该组。

本地多播路由器要周期性地在每个接口上发送IGMP查询报文探查本地局域网上的主机，以便知道这些主机是否还继续是组的成员。只要有一个主机对某个组响应，那么多播路由器就认为这个组是活跃的。但一个组在经过几次的查询后仍然没有一个主机响应，多播路由器就认为本网络上的主机已经都离开了这个组。路由器对每个接口维护一张表，表中记录该接口对应的每个组及其主机数。默认查询周期是125秒。

主机收到IGMP查询报文后，要针对所在的每个组，都返回一个IGMP报告报文。主机并不在收到IGMP查询报告后立即响应报告，应当等待一段随机时间后再报告，如果同一网络内的其他主机报告了同一组，则该主机不再报告该组。

在主机和多播路由器之间的所有通信都是使用IP多播。只要可能，携带IGMP报文的数据报都用硬件多播来传送，因此支持硬件多播的网络上，没有参加IP多播的主机不会收到IGMP报文。

## 报文格式

IGMP报文封装在IP数据报的数据部分。

<table>
	<tr>
		<th>位</th>
		<th>4</th>
		<th>4</th>
		<th>8</th>
		<th>16</th>
		<th>32</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>版本（1）</td>
		<td>类型</td>
		<td>0</td>
		<td>校验和</td>
		<td>组IP地址</td>
	</tr>
</table>
	
##### 类型	

1表示查询，2表示报告

##### 组IP地址	

在IGMP查询报文中为0，在IGMP报告报文中是要参加的组地址。