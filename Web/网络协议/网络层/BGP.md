# BGP

Border Gateway Protocol

边界网关协议

BGP是一种不同自治系统的路由器之间进行通信的外部网关协议。

BGP力求寻找一条能够到达目的网路的较好路由，但无法找到最佳路由。

AS管理员要选择至少一个路由器作为发言人，BGP交换的网络可达性信息是要达到目的网络要经过的一系列AS。BGP刚开始运行时，邻站间交换整个BGP路由表，以后只需要发生变化时更新有变化的部分。

## BGP报文

BGP报文封装在TCP报文的数据部分。

<table>
	<tr>
		<th>字节</th>
		<th>16</th>
		<th>2</th>
		<th>1</th>
		<th>可变</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>标记</td>
		<td>长度</td>
		<td>类型</td>
		<td>主体</td>
	</tr>
	</tr>
</table>
	
##### 标记

用于鉴别。不使用鉴别时置为全1。

##### 长度

整个BGP报文长度，单位为字节。

##### 类型字段

指出BGP报文类型，其对应的主体字段也不同。

| 字段值 | 类型 | 描述 |
|---|---|---|
| 1 | OPEN | 与邻站BGP发言人建立关系，通信初始化 |
| 2 | UPDATE | 通告某一路由信息，列出多条撤销路由，只能列出一条新增路由 |
| 3 | KEEPALIVE | 周期性证实邻站连通性 |
| 4 | NOTIFICATION | 发送检测到的差错 |

## 各类型报文主体字段

### OPEN

<table>
	<tr>
		<th>字节</th>
		<th>1</th>
		<th>2</th>
		<th>2</th>
		<th>4</th>
		<th>1</th>
		<th>可变</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>版本</td>
		<td>自治系统号</td>
		<td>保持时间</td>
		<td>标识符</td>
		<td>可选参数长度</td>
		<td>可选参数</td>
	</tr>
	</tr>
</table>

##### 版本

当前版本号为4。

##### 自治系统号

全球唯一自治系统号。

##### 保持时间

以秒为单位，保持为邻站关系的时间。

##### 标识符

通常是该路由器IP地址。

---

### UPDATE

<h3>UPDATE</h3>

<table>
	<tr>
		<th>字节</th>
		<th>2</th>
		<th>可变</th>
		<th>2</th>
		<th>可变</th>
		<th>可变</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>不可行路由长度</td>
		<td>撤销路由</td>
		<td>路径属性总长度</td>
		<td>路径属性</td>
		<td>网络层可达性信息</td>
	</tr>
</table>

##### 不可行路由长度

撤销路由字段长度。

##### 撤销路由

列出所有要撤销的路由。

##### 路径属性总长度

路径属性字段长度。

##### 路径属性

定义报文中增加的路径的属性。

---

### KEEPALIVE

不存在主体字段。

### NOTIFICATION

<table>
	<tr>
		<th>字节</th>
		<th>1</th>
		<th>1</th>
		<th>可变</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>差错码</td>
		<td>差错子码</td>
		<td>差错数据</td>
	</tr>
</table>
