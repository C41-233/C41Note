# OSPF

Open Shortest Path First

开放最短路径优先

OSPF路由协议是一种典型的链路状态（Link-state）的路由协议，一般用于同一个路由域内。在这里，路由域是指一个自治系统（Autonomous System），即AS，一组通过统一的路由政策或路由协议互相交换路由信息的网络。在这个AS中，所有的OSPF路由器都维护一个相同的描述这个AS结构的数据库，该数据库中存放的是路由域中相应链路的状态信息，OSPF路由器正是通过这个数据库计算出其OSPF路由表的。

作为一种链路状态的路由协议，OSPF将链路状态广播数据LSA（Link State Advertisement）传送给在某一区域内的所有路由器，这一点与距离矢量路由协议不同。运行距离矢量路由协议的路由器是将部分或全部的路由表传递给与其相邻的路由器。

OSPF向本自治系统中的所有路由器发送信息，通过所有输出端口向所有相邻路由器发送信息，这样整个区域中的路由器最终都得到这个信息的副本。发送的信息是本路由器与相邻的所有路由器的链路状态，链路状态包括本路由器与哪些路由器相邻以及该链路的度量。度量可以由费用、距离、时延、带宽决定。只有当链路状态发生变化时，路由器才向所有路由器发送消息。

每2个相邻路由器每隔10秒交换一次问候分组，若40秒没收到某个相邻路由器发来的问候分组，则认为给相邻路由器不可达，应立即修改链路状态数据库，并重新计算路由表。

## 区域

OSPF将一个自治系统再划分为若干个更小的范围，称为区域。每个区域都有32位标识符。利用洪泛法交换链路状态信息的范围局限在每个区域，减少网络通信量。

使用层次结构划分区域，上层的区域称为主干区域，标识符规定为0.0.0.0，用来连通其他在下层的区域。每个区域都应当至少包括一个区域边界路由器，用来与其他区域通信。

## OSPF报文

OSPF报文封装在IP数据报的数据部分。

<table>
	<tr>
		<th>字节</th>
		<th>1</th>
		<th>1</th>
		<th>2</th>
		<th>4</th>
		<th>4</th>
		<th>2</th>
		<th>2</th>
		<th>4</th>
	</tr>
	<tr>
		<th>字段</th>
		<td>版本</td>
		<td>类型</td>
		<td>分组长度</td>
		<td>路由器标识符</td>
		<td>区域标识符</td>
		<td>检验和</td>
		<td>鉴别类型</td>
		<td>鉴别</td>
	</tr>
</table>
	
##### 版本

当前OSPF版本为2。

##### 类型

标识报文类型。

- 1	问候报文（HELLO），用来发现和维持邻站可达性。
- 2	数据库描述报文（DBD），向邻站给出自己链路状态数据库中所有链路状态项目摘要信息。
- 3	链路状态请求报文（LSR），向对方请求发送某些链路状态项目的详细信息。
- 4	链路状态更新报文（LSU），向对方请求发送某些链路状态项目的详细信息。
- 5	链路状态确认报文（LSACK），对链路更新分组的确认。

##### 分组长度

包括OSPF首部在内的报文长度，单位为字节。

##### 路由器标识符

发送该分组的路由器的接口IP地址。

##### 区域标识符、

分组属于的区域标识符。

##### 鉴别类型

0表示不使用，1表示使用口令。

##### 鉴别

不使用鉴别时填入0，使用口令时填入8个字符的口令。